<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Wyszukiwarka tytułów</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    header {
      background: #f8f8f8;
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 10;
      flex-shrink: 0; /* nie zmniejszaj nagłówka */
    }
    body {
      font-family: sans-serif;
      margin: 2rem;
      background: #f4f4f4;
    }
    h1 {
      color: #222;
    }
    input {
      padding: 0.6rem;
      width: 100%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    ul {
      margin-top: 1.5rem;
      padding-left: 0;
      list-style: none;
    }
    /* li {
      /* background: white; */
      /* padding: 1rem; */
      /* margin-bottom: 1rem; */
      /* border-radius: 6px; */
      /* box-shadow: 0 2px 4px rgba(0,0,0,0.1); */
    /*} */
    a {
      color: #007acc;
      text-decoration: none;
      font-weight: bold;
    }
    .tytul {
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
    }
    .slowa {
      font-size: 1.1rem;
      color: #868887;
    }
    .autor {
      font-size: 0.6rem;
      color: #666;
    }   
  </style>
</head>
<body>
  <header>
  <h1>Wyszukiwarka tytułów piosenek</h1>
  <input type="text" id="searchInput" placeholder="Wpisz słowo kluczowe...">
  <select id="levelSelect" multiple size="4">
    <option value="LM">Masowe</option>
    <option value="LZ">Znane</option>
    <option value="LN">Nieznane</option>
    <option value="LU">Nieokreślone</option>
  </select>
  <select id="typeSelect" multiple size="4">
    <option value="L">Poetyckie</option>
    <option value="M">Żeglarskie</option>
    <option value="P">Popularne</option>
    <option value="T">Turystyczne</option>
    <option value="H">Harcerskie</option>
    <option value="K">Kabaretowe</option>
    <option value="I">Inne</option>
  </select>

  </header>
 
  <ul id="resultsList"><li>Ładowanie danych...</li></ul>

  <script>
    const input = document.getElementById('searchInput');
    const list = document.getElementById('resultsList');
    const levelSelect = document.getElementById('levelSelect');
    const typeSelect = document.getElementById('typeSelect');
    let entries = [];

    fetch('tytuly.json')
      .then(res => res.json())
      .then(data => {
        entries = data.map(e => ({
          ...e,
          titleLower: e.title.toLowerCase(),
          authorLower: e.author.toLowerCase(),
          keysLower: e.keys.map(k => k.toLowerCase())
        }));
        applyFilters();
      })
      .catch(() => {
        list.innerHTML = '<li style="color: red;">Błąd ładowania danych</li>';
      });

    function showResults(items) {
      list.innerHTML = '';
      if (items.length === 0) {
        list.innerHTML = '<li>Brak wyników</li>';
        return;
      }

      items.forEach(entry => {
        const li = document.createElement('li');
        li.innerHTML = `
          <div style="display:flex; gap:10px;">
            <div class="tytul"><a href="${entry.link}">${entry.title}</a></div>
            <div class="slowa">(${entry.author})</div>
          </div>
        `;
        list.appendChild(li);
      });
    }

    function debounce(fn, delay) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), delay);
      };
    }

    function getSelectedValues(select) {
      return Array.from(select.selectedOptions).map(o => o.value);
    }

    function applyFilters() {
      const query = input.value.toLowerCase().trim();
      const selectedLevels = getSelectedValues(levelSelect);
      const selectedTypes = getSelectedValues(typeSelect);

      const filtered = entries.filter(entry => {
        // tekst
        const matchesText =
          !query ||
          entry.keysLower.some(word => word.includes(query)) ||
          entry.titleLower.includes(query) ||
          entry.authorLower.includes(query);

        // level
        const matchesLevel =
          selectedLevels.length === 0 || selectedLevels.includes(entry.level);

        // type
        const matchesType =
          selectedTypes.length === 0 || selectedTypes.includes(entry.type);

        return matchesText && matchesLevel && matchesType;
      });

      showResults(filtered);
    }

    // zdarzenia
    input.addEventListener('input', debounce(applyFilters, 200));
    levelSelect.addEventListener('change', applyFilters);
    typeSelect.addEventListener('change', applyFilters);
  </script>

</body>
</html>
